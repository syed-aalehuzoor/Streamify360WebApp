class c{constructor(e,t,i="*",s=10485760,r=null){if(!e||!t)throw new Error("fileName and containerId are required");this.fileInputId="filename-"+e,this.containerId=t,this.maxChunkSize=s,this.currentChunkSize=s,this.acceptedTypes=i,this.onFinalizeCallback=r,this.isUploading=!1,this.createUIElements(),this.initializeEventListeners()}createUIElements(){var e=document.getElementById(this.containerId);if(!e)throw new Error(`Container with id "${this.containerId}" not found`);this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.id=this.fileInputId,this.fileInput.accept=this.acceptedTypes,e.appendChild(this.fileInput),this.errorBox=document.createElement("div"),this.errorBox.id=this.fileInputId+"-errorbox",this.errorBox.className="text-red-600 text-sm",e.appendChild(this.errorBox),this.progressContainer=this.createProgressContainer(),e.appendChild(this.progressContainer)}createProgressContainer(){var e=document.createElement("div"),t=(e.id=this.fileInputId+"-progress-container",e.className="mt-6 p-4 border border-gray-300 rounded-lg bg-white shadow-lg",e.style.display="none",document.createElement("div")),t=(t.className="relative h-2 w-full bg-gray-200 rounded-full overflow-hidden",this.progressBar=document.createElement("div"),this.progressBar.id=this.fileInputId+"-progress-bar",this.progressBar.className="absolute top-0 left-0 h-full bg-blue-500 transition-all duration-300",this.progressBar.style.width="0%",t.appendChild(this.progressBar),e.appendChild(t),document.createElement("div")),i=(t.className="flex justify-between items-center mt-3",document.createElement("div"));return i.className="text-sm text-gray-700 font-semibold animate-pulse",i.innerText="Uploading...",t.appendChild(i),this.percentageText=document.createElement("div"),this.percentageText.id=this.fileInputId+"-percentage-text",this.percentageText.className="text-sm text-gray-700 font-semibold animate-pulse",t.appendChild(this.percentageText),e.appendChild(t),e}initializeEventListeners(){this.fileInput.addEventListener("change",async e=>{e=e.target.files[0],e&&(this.isUploading?this.showError("An upload is already in progress"):await this.handleFileUpload(e))})}async callAPI(e,t="POST",i=null,s="application/json",r={}){var o;try{r["X-CSRF-TOKEN"]=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content,s&&(r["Content-Type"]=s);var l=await fetch(e,{method:t,headers:r,body:i});if(l.ok)return await l.json();throw new Error("HTTP error! status: "+l.status)}catch(n){throw new Error("API request failed: "+n.message)}}updateProgress(e){e=Math.min(Math.max(e,0),100),this.progressBar.style.width=e+"%",this.percentageText.innerText=e+"%"}showError(e){this.errorBox.innerText="Error: "+e,this.progressContainer.style.display="none"}async uploadChunk(e){return e=(await this.callAPI("/api/upload-chunk","POST",e,null)).success,e}async handleFileUpload(e){this.isUploading=!0,this.errorBox.innerText="";try{this.currentChunkSize=Math.min(Math.ceil(e.size/100),this.maxChunkSize);var{success:t,upload_id:i}=await this.callAPI("/api/initiate","POST");if(!t)throw new Error("Upload initiation failed");this.progressContainer.style.display="block";let n=Math.ceil(e.size/this.currentChunkSize),h=[],d=0;for(let a=0;a<n;a++){var s=e.slice(a*this.currentChunkSize,(a+1)*this.currentChunkSize),r=new FormData;r.append("file",s),r.append("upload_id",i),r.append("chunkIndex",a),h.push(this.uploadChunk(r).then(()=>{d++,this.updateProgress(Math.round(d/n*100))})),(a+1)%5!=0&&a!==n-1||(await Promise.all(h),h=[])}var l=JSON.stringify({upload_id:i,totalChunks:n,fileExtension:e.name.split(".").pop()}),o=(await this.callAPI("/api/finalize","POST",l)).success;if(!o)throw new Error("Upload finalization failed");this.errorBox.innerText="Upload completed successfully!",this.onFinalizeCallback&&this.onFinalizeCallback(i)}catch(n){this.showError(n.message)}finally{this.isUploading=!1}}}export{c as F};
